<style>
.accordion {
    background-color: #eee;
    color: #444;
    cursor: pointer;
    padding: 18px;
    width: 100%;
    border: none;
    text-align: left;
    outline: none;
    font-size: 15px;
    transition: 0.4s;
}
.active, .accordion:hover {
    background-color: #ccc;
}
.accordion:after {
    content: '\002B';
    color: #777;
    font-weight: bold;
    float: right;
    margin-left: 5px;
}
.active:after {
    content: "\2212";
}
.panel {
    padding: 0 18px;
    background-color: white;
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.2s ease-out;
}
</style>

<% puts "i got here" %>
<% puts params[:id] %>

<% @client = Client.find(params[:id]) %>
<% @notes = Note.where(client_id: @client) %>

<h1>Notes for <%= @client.first_name %> <%= @client.last_name %></h1>

<div style="margin: 1em 1em 1em 1em;">
  <table style="width: 100%; ">
    <thead>
      <tr>
        <th>Client name</th>
        <th>Counselor name</th>
        <th>Status</th>
        <th>Content</th>
        <th colspan="4"></th>
      </tr>
    </thead>

  <tbody>
    <% @notes.each do |note| %>
      <tr>
        <td><%= note.client_name %></td>
        <td><%= note.counselor_name %></td>
        <td>
          <%= note.status %>
<select>
  <option>Open</option>
  <option>Submitted</option>
  <option>Accepted</option>
  <option>Rejected</option>
</select>
        </td>
        <td><%= note.client_id %></td>
      </tr>
      <tr>
        <td colspan="4">
          <button class="accordion">session <%= note.session_number %></button>
          <div class="panel">
            <br><textarea id="editor"><%= note.content %></textarea><br>
            <button>Save Note</button>
          </div>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<br><br>
<h3>Create Note for Client</h3>
<br>

		<%= form_for Note.new do |f| %>
		<div class="field">
			<%= f.label :session_number %>
			<%= f.text_field :session_number, :value => @notes.length+1 %>
		</div>

    <div class="field">
			<%= f.label :client_name %>
			<%= f.text_field :client_name, :value => @client.first_name %>
		</div>

		<div class="field">
      <%= f.label :counselor_name %>
      <% begin %> <!-- client may be unassigned -->
        <% @counselor = User.find(@client.counselor_id) %>
        <%= f.text_field :counselor_name, :value => @counselor.name %>
      <% rescue => ex %>
        <%= f.text_field :counselor_name %>
      <% end %>
		</div>

    <div class="field">
			<%= f.label :status %>
			<%= f.text_field :status %>
		</div>

    <div class="field">
      <%= f.label :content %>
      <%= f.text_area :content %>
    </div>

    <div class="field">
      <%= f.label 'hidden:client:id' %>
      <%= f.text_field :client_id, :value => @client.id %>
    </div>

		<div class="actions">
			<%= f.submit "Sign up" %>
		</div>
		<% end %>


<script src="https://cdn.ckeditor.com/4.7.3/standard/ckeditor.js"></script>
<script>
  CKEDITOR.replace( 'editor' );
  var acc = document.getElementsByClassName("accordion");
  var i;
  for (i = 0; i < acc.length; i++) {
    acc[i].addEventListener("click", function() {
      this.classList.toggle("active");
      var panel = this.nextElementSibling;
      if (panel.style.maxHeight){
        panel.style.maxHeight = null;
      } else {
        panel.style.maxHeight = panel.scrollHeight + "px";
      }
    });
  }
</script>
