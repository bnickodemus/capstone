<br><h1>Sign Up</h1>

<div style="text-align: center;">

<% client = @client %>
<%= form_for(@client, local: true) do |form| %>

  <!-- error checking doesnt work with auto_fill -->
  <!--<% if client.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(client.errors.count, "error") %> prohibited this client from being saved:</h2>
      <ul>
        <% client.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>-->

  <div class="field fieldStyle">
    <%= form.text_field :first_name, id: :client_first_name, placeholder: "First Name" %>
    <%= form.text_field :last_name, id: :client_last_name, placeholder: "Last Name" %>
  </div>

  <div class="field fieldStyle">
    <%= form.label :dob %>
    <%= form.date_select :dob, id: :client_dob %>
  </div>

  <div class="field fieldStyle">
    <%= form.text_field :phone_number, id: :client_phone_number, placeholder: "Phone Number" %>
    <%= form.check_box :leave_message, id: :client_leave_message %>
    <%= form.label :leave_message %>
  </div>

  <div class="field fieldStyle">
    <%= form.text_field :email, id: :client_email, placeholder: "Email" %>
    <%= form.text_field :occupation, id: :client_occupation, placeholder: "Occupation" %>
  </div>

  <div class="field fieldStyle">
    <%= form.text_field :employer, id: :client_employer, placeholder: "Employer" %>
    <%= form.text_field :employer_address, id: :client_employer_address, placeholder: "Employer Address" %>
  </div>

  <div class="field fieldStyle">
    <%= form.text_field :work_phone, id: :client_work_phone, placeholder: "Work Phone" %>
    <%= form.check_box :leave_message_work, id: :client_leave_message_work %>
    <%= form.label :leave_message_work %>
  </div>

  <hr>

  <h5>Spouse Information</h5><br>
  <div class="field fieldStyle">
    <%= form.text_field :spouse_first_name, id: :client_spouse_first_name, placeholder: "Spouse First Name" %>
    <%= form.text_field :spouse_last_name, id: :client_spouse_last_name, placeholder: "Spouse Last Name" %>
  </div>

  <div class="field fieldStyle">
    <%= form.label :spouse_dob %>
    <%= form.date_select :spouse_dob, id: :client_spouse_dob %>
  </div>

  <div class="field fieldStyle">
    <%= form.text_field :spouse_occupation, id: :client_spouse_occupation, placeholder: "Spouse Occupation" %>
    <%= form.text_field :spouse_employer, id: :client_spouse_employer, placeholder: "Spouse Employer" %>
  </div>

  <div class="field fieldStyle">
    <%= form.text_field :spouse_phone, id: :client_spouse_phone, placeholder: "Spouse Phone" %>
  </div>

  <hr>

  <h5>Other Members of Your Household (optional)</h5>

  <div class="field fieldStyle"><%= select_tag "quantity", options_for_select((1..4),1), :onchange => 'changed(this)' %></div>
  <% 4.times do |i| %>
    <%= form.fields_for :family_members, FamilyMember.new do |family_member_form| %>
      <p id="<%= i.to_s %>">
        <%= family_member_form.text_field :name, placeholder: "Name" %>
        <%= family_member_form.text_field :age, placeholder: "Age" %>
        dob: <%= family_member_form.date_select :dob %>
        <%= family_member_form.text_field :relation, placeholder: "Relation" %>
      </p>
    <% end %>
  <% end %>
  <hr>

  <h5>Emergency Contact Information</h5><br>
  <div class="field fieldStyle">
    <%= form.text_field :emergency_name, id: :client_emergency_name, placeholder: "Name" %>
    <%= form.text_field :emergency_relation, id: :client_emergency_relation, placeholder: "Emergency Relation" %>
  </div>

  <div class="field fieldStyle">
    <%= form.text_field :emergency_address, id: :client_emergency_address, placeholder: "Emergency Address" %>
    <%= form.text_field :emergency_phone, id: :client_emergency_phone, placeholder: "Emergency Phone" %>
  </div>

  <div class="field fieldStyle">
    <%= form.check_box :health_insurance, id: :client_health_insurance %>
    <%= form.label :health_insurance %>
    <%= form.text_field :insurance_company, id: :client_insurance_company, placeholder: "Insurance Company" %>
  </div>

  <hr>

  <h5>History</h5><br>
  <div class="field fieldStyle">
    <%= form.text_field :physician, id: :client_physician, placeholder: "Physician" %>
    <%= form.text_field :physician_phone, id: :client_physician_phone, placeholder: "Physician Phone" %>
  </div>

  <div class="field fieldStyle">
    <%= form.text_field :medication, id: :client_medication, placeholder: "Medication" %>
    <%= form.text_field :help_reason, id: :client_help_reason, placeholder: "Help Reason" %>
  </div>

  <div class="field fieldStyle">
    <%= form.check_box :counselor_seen_before, id: :client_counselor_seen_before %>
    <%= form.label :counselor_seen_before %>
    <%= form.text_field :counselor_seen, id: :client_counselor_seen, placeholder: "Counselor Seen" %>
  </div>

  <hr>

  <button type="button" class="btn btn-primary" onclick="show('InformedConsent')">Informed Consent for Video/Audio Recording</button><br>
  <div id="InformedConsent" style="display: none; padding-left: 20%; padding-right: 20%;">
    <br>As a graduate student, I am required to be under the direct supervision of qualified clinical
    supervisors. My supervisors review all aspects of the services that I am providing to you. You have the
    right to know the name of my supervisor(s) and how to contact her or him. This information is listed
    above. In addition, as part of my program and clinical supervision requirements, I electronically record
    my counseling sessions. These recordings are reviewed during clinical supervision for the purposes of
    facilitating my learning and effectiveness as a developing counselor. Recordings are kept secure and
    confidential, and they are never shared with any person who is not part of the OSU Counseling program.
    Recordings are erased after the clinical requirements have been met.<br><br>

    Your signature (as the client/and parent or guardian) below confirms that this form has been explained
    to you, and that you understand the following: I am not required and I am under no obligation to have
    counseling sessions recorded. I may withdraw my permission at any time during or after the recording
    session. My care will not change by my decision not to be recorded. I have the right to review my
    recording(s) with my student counselor during a counseling session. My student counselor receives
    supervision both at this location and by the faculty at Oregon State University Cascades. The contents
    of this recording will remain confidential within the supervision at OSU Cascades. Recordings are erased
    after the clinical requirements have been met. I may revoke this consent at any time by submitting to
    the student counselor a request to withdraw my (as a client, parent/guardian) permission. The original copy
    of this consent form will be kept in my records wit this agency. This recording will only be used as a
    tool to help my student counselor in assisting me or my family.
  </div>

  <div style="padding-top: 1em;">
    <button type="button" class="btn btn-primary" onclick="show('TreatmentConsent')">Informed Consent for Counseling</button><br>
  </div>

  <div style="padding-top: 1em;">
    <button type="button" class="btn btn-primary" onclick="show('VideoConsent')">Informed Consent for Treatment</button><br>
  </div><br>

  I agree to the following conscent forms:<br>
  Audio/Video Consent&nbsp;<input id="checkBox" type="checkbox" checked><br>
  Counseling Consent&nbsp<input id="checkBox" type="checkbox" checked><br>
  Treatment Consent&nbsp;<input id="checkBox" type="checkbox" checked><br><br>

  <strong>Draw your signature into the box below</strong><br>
  <canvas style="border: 1px solid black" id="signature-pad" class="signature-pad" width=800 height=300></canvas><br>
  <button id="save-png">Save as PNG</button>
  <button id="clear">Clear</button><br><br>

  <%= check_box_tag :autofill, true, (@auto_fill == 'true') %> autofill form

  <div style="margin-top: 1em;">
    <%= form.submit "Sign Up", :class => 'btn btn-primary' %>
  </div><br>

<% end %>
</div>

<script src="https://cdn.jsdelivr.net/npm/signature_pad@2.3.2/dist/signature_pad.min.js"></script>
<script>

  $(document).ready(function() {
    for (var i = 0; i < 3; i++) {
      document.getElementById(i.toString()).style.display = 'none';
    }

    $("body").tooltip({ selector: '[data-toggle=tooltip]' });
  });

  function changed(sel) {
    var taskNum = sel.options[sel.selectedIndex].value;
    for (var i = 3; i >= 0; i--) {
      if (taskNum <= i) {
        document.getElementById(i.toString()).style.display = 'none';
      } else {
        document.getElementById(i.toString()).style.display = 'block';
      }
    }
  }

  function show(id) {
    var element = document.getElementById(id);
    if (element.style.display === "none") {
      element.style.display = "block";
    } else {
      element.style.display= "none";
    }
  }
  var signaturePad = new SignaturePad(document.getElementById('signature-pad'), {
    backgroundColor: 'rgba(255, 255, 255, 0)',
    penColor: 'rgb(0, 0, 0)'
  });

  document.getElementById('save-png').addEventListener('click', function () {
    if (signaturePad.isEmpty()) {
      return alert("Please provide a signature first.");
    }

    var data = signaturePad.toDataURL('image/png');
    console.log(data);
    window.open(data);
  });

  document.getElementById('clear').addEventListener('click', function () {
    signaturePad.clear();
  });

</script>
